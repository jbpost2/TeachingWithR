---
title: "Exercise: What's in a Name??"
subtitle: "2021 USCOTS Workshop: TeachingWithR"
author: "Matthew Beckman & Justin Post"
date: "June 25, 2021"
output: html_document
---


# Introduction



# Part 1. RStudio IDE Scavenger Hunt

- RStudio GUI 
    - Restart your R Session
    - Create a new "R Markdown" file (keep the default text for now)
    - Install `lubridate` packages (with dependencies if needed)
    - search the Help for [something important]
    - open a New Terminal
    - What types of data sources can be imported using the RStudio GUI
    
- Locate the following configuration preferences (Tools >> Global Options)
    - Pane Layout
    - "Rainbow parenthesis"
    - "Show margin" (set to 80)
    - "Highlight selected line"
    - "Provide R style diagnostics (e.g., whitespace)"
    - "Show whitespace characters" 


# Part 2. Import Data


## 2.1 Libraries

- **Task 1:** call the `dcData` and `tidyverse` libraries   
    - `dcData` is hosted on GitHub and not CRAN!  
    - `devtools::install_github("mdbeckman/dcData")`
    - may take a while (30+ sec?) depending on Internet speed




## 2.2 Data Intake: `BabyNames`

Read `BabyNames` data from `dcData` into R

- Locate the `BabyNames` object in the Environment pane
- Double click the object name to open a spreadsheet View
- Spreadsheet view includes basic sorting capability
- **Task 1:** how many total rows of data are there?  (& where can you find this?)
- **Task 2:** describe what each row in the data *actually* represents
- **Task 3:** find the largest `count` in the `BabyNames` data.  How would you interpret this result?
- **Task 4:** what are the max & min available `year` in the data?


## 2.3 Data Intake: `BabyNamesSupp` 

BabyNameSupp.CSV includes a few years of recent data.  

- Run the starter code below
- **Task 1:** the starter code produces a warning message; what went wrong?
- **Task 2:** open the spreadsheet view to investigate `BabyNamesSupp` further... 
- **Task 3:** why did we have this problem, and which argument might fix it?
    - Hint: "RStudio >> Help >> read_csv" 
    - don't worry about *actually* fixing it yet, just try to identify root cause.

````
# starter code for BabyNamesSupp 
BabyNamesSupp <- read_csv("https://www4.stat.ncsu.edu/~online/datasets/BabyNamesSupp.csv")
````

## 2.4 Help Documentation

- Search "RStudio >> Help" to learn about the data...
    - help for `BabyNames` from `dcData` 
    - **Task 1:** what can you learn about the `BabyNames` data from the Help?
    - help for BabyNamesSupp
    - **Task 2:** what have you learn about the `BabyNamesSupp` data from the Help?  What happened?
    
## 2.5 Challenge

**Task 1:** Find 2020 name data and read it into R (hint: start with the `BabyNames` help documentation).


## Partial Solutions 

At this point, we haven't attempted to process the `BabyNamesSupp` or the 2020 data.  We're just reading them into the R environment and making observations about that process.  

We'll be using this data again later in the exercises, so we will make the necessary corrections at that point.

### Libraries
Task 2.1.1: see code chunk that follows

Task 2.2.1: about 1.8 million rows.  We can see this from environment tab, spreadsheet view (footer), among other places
Task 2.2.2: The frequency of a given name, within a year, associated with a `sex`
Task 2.2.3: According to US Social Security records, 1947 was a banner year to name a female Linda!
Task 2.2.4: `BabyNames` data spans 1880 through 2013

Task 2.3.1: The warning indicates a "parsing failure" and shows that R was expecting logical elements (e.g., TRUE/FALSE) and found "M" in many cases
Task 2.3.2: Yup, R interpreted "F" (meaning female, here) to mean FALSE and failed to process "M" appropriately as a result.
Task 2.3.3: `read_csv( )` guesses variable class based on the first 1000 records.  The data source had apparently sorted results such that the first 1000 (or more) rows were all "F" so `read_csv( )` concluded these to be logical (T/F) results.  Quite a reasonable default under most circumstances, but illustrates why we should always carefully inspect our data intake! 

Task 2.4.1: Lots! The package author has described the data, explained the variables, provided a source, etc.
Task 2.4.2: Nothing!  The data were read from an external file, so R doesn't have any information at all to share with us.

Task 5.5.1 (Challenge): visit "RStudio >> Help >> BabyNames >> Source" and then download the zip file to find the 2020 data inside.  This can be read into R using `read_csv( )` even though the file extension is `.txt` since the data are comma delimited.  You may note that the structure of the data differs slightly from our two other sources, so we will need some new tools to process it for use.

```{r}
## from instructions before workshop, if needed
# devtools::install_github("mdbeckman/dcData")

# Task 2.2.1 libraries
library(tidyverse)
library(dcData)

## data intake
data("BabyNames", package = "dcData")
BabyNamesSupp <- read_csv("../datasets/BabyNamesSupp.csv")  # `sex` produces warning


## challenge
# locate zip file including all years of data, identify 2020 and read into R:
yob2020 <- read_csv("../datasets/yob2020.txt", col_names = FALSE)


```




# Part 3. R Markdown 

Note: you might hang onto the RStudio boilerplate for a moment... it's packed with tiny examples that will come in handy!

- we'll be investigating the popularity of names in the US each year
- Choose a few names to investigate to you (friends, family, TV character, colleagues in the workshop!)

- "Knit" the document to render the initial HTML document
- Task 1: update yaml header for your investigation
    - "Knit" 


````
---
title: "..."
author: "..."
date: "..."
output: html_document
---
````


- Task 2: Write a bit of narrative to introduce the project (no R code) 
    - make a few remarks about 
    - write a few sentences to introduce the project
        - Given intro about what you're doing & your data source (US Social Security)
        - Which names have you chosen to investigate?   
        - "Knit" 
        - Add a bullet list of "famous" persons that share the name
        - "Knit"

- create an R code chunk to set up for the investigation
    - call the `tidyverse` and `dcData` libraries
    - data intake that makes earlier work reproducible
        - `BabyNames` from `dcData` package
        - `BabyNamesSupp.csv`

- At the end of the document, add a note with a time/date stamp of when the analysis was last modified.  Call the R function `now()` directly from lubridate package INLINE for the time stamp.
    - "Knit" (notice the time stamp)
    - "Knit" again (notice the time stamp)


- Rendering the document in a few different forms
    - slides (e.g., `output: slidy_presentation`)
    - R Notebook (e.g., `html_notebook`)
    - knit MS Word (if you have it)

- XC: 
    - can you spot any differences b/w R Notebook & R Markdown doc? 
    - simultaneously knit a slidy presentation & an R Notebook doc (two lines of output in yaml)
    - PDF (`tinytex::install_tinytex()` if needed)
    - add some LaTeX to your document (e.g, a simple display equation) & knit the document


# Part 4. Data wrangling


- **Task:** `bind_rows()` to combine `BabyNames` & `BabyNamesSupp` 

- filter, arrange, rename, mutate, select, group_by, summarise, etc
- two different filter takes--hard coded, vs %in% vector
- group_by, summarise, arrange for overall popularity of each name
- filter to just investigate popularity in the year you joined your current institution 
(or year you were born, or any single year you like) and repeat

XC: 

- `pivot_wider()` & mutate to calculate balance b/w sexes for each name?
- join for the totals?
- arrange to review


```{r}
## data intake
data("BabyNames", package = "dcData")
BabyNamesSupp <- read_csv("../datasets/BabyNamesSupp.csv",  
                          col_types = cols(sex = col_character()))  # fixes `sex`
    

# processing 2020 data intake to align with other years of data
yob2020 <- 
    read_csv("../datasets/yob2020.txt", col_names = FALSE, 
             col_types = cols(X2 = col_character())) %>%
    rename(name = X1, sex = X2, count = X3) %>%
    mutate(year = 2020)


BabyNamesFull <- bind_rows(BabyNames, BabyNamesSupp, yob2020)


```


# Part 5. Graph it

- sketch (by hand) the chart you plan to make
    - trend of popularity over time
    - overlay?
    - facet?
- try it with `ggplot2`


- `esquisse::esquisser()` for draft plotting while getting the hang of `ggplot2` 
    - copy the code, paste into Rmd chunk
    - modifiy it to customize the rest of the way
    - ideally, you'll soon skip the esquisse step as you get the hang of the ggplot2 framework

XC: 
- bar chart overall popularity use sexes to fill/stack?

